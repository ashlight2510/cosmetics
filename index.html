<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      property="og:image"
      content="https://dummyimage.com/1200x630/0f172a/ffffff&text=Cosmetics"
    />
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='14' fill='%232f5cff'/%3E%3Cpath d='M20 40c6-8 18-8 24 0' stroke='%23fff' stroke-width='4' stroke-linecap='round' fill='none'/%3E%3Ccircle cx='24' cy='26' r='4' fill='%23fff'/%3E%3Ccircle cx='40' cy='26' r='4' fill='%23fff'/%3E%3C/svg%3E"
    />
    <title>í™”ì¥í’ˆ ë£¨í‹´ ë”¸ê¹ ì²´í¬</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
        margin: 0;
        background: linear-gradient(to bottom right, #fef3f2, #f3e8ff, #e0f2fe);
        min-height: 100vh;
        color: #111;
      }
      .lang-switch {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 50;
        display: inline-flex;
        gap: 6px;
        padding: 4px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .lang-switch button {
        border: none;
        background: transparent;
        color: #666;
        font-size: 12px;
        font-weight: 700;
        padding: 6px 12px;
        border-radius: 999px;
        cursor: pointer;
        letter-spacing: 0.08em;
        transition: all 0.2s;
      }
      .lang-switch button.active {
        background: #2f5cff;
        color: #fff;
      }
      .lang-switch button:not(.active):hover {
        color: #2f5cff;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 80px 20px 40px;
      }
      /* Start Screen */
      .start-screen {
        text-align: center;
        animation: fadeIn 0.5s ease-in;
      }
      .start-screen h1 {
        font-size: 2.5rem;
        font-weight: 800;
        margin: 0 0 16px;
        color: #1a1a2e;
      }
      .start-screen .subtitle {
        font-size: 1.1rem;
        color: #555;
        line-height: 1.6;
        margin-bottom: 32px;
      }
      .start-btn {
        background: linear-gradient(to right, #ec4899, #8b5cf6, #3b82f6);
        color: white;
        border: none;
        border-radius: 999px;
        padding: 16px 48px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        transition: all 0.3s;
      }
      .start-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }
      /* Question Screen */
      .question-screen {
        display: none;
      }
      .question-screen.active {
        display: block;
        animation: fadeIn 0.5s ease-in;
      }
      .progress-bar {
        margin-bottom: 24px;
      }
      .progress-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 14px;
        font-weight: 600;
        color: #555;
      }
      .progress-bar-fill {
        width: 100%;
        height: 8px;
        background: #e5e7eb;
        border-radius: 999px;
        overflow: hidden;
      }
      .progress-bar-fill div {
        height: 100%;
        background: linear-gradient(to right, #ec4899, #8b5cf6, #3b82f6);
        border-radius: 999px;
        transition: width 0.5s ease-out;
      }
      .question-card {
        background: white;
        border-radius: 24px;
        padding: 32px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 24px;
      }
      .question-card h2 {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 0 24px;
        text-align: center;
        color: #1a1a2e;
      }
      .choices {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .choice-btn {
        width: 100%;
        padding: 16px 20px;
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        background: white;
        color: #333;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        text-align: left;
        transition: all 0.2s;
      }
      .choice-btn:hover {
        border-color: #8b5cf6;
        background: #f3e8ff;
        transform: translateX(4px);
      }
      .choice-btn.selected {
        background: linear-gradient(to right, #ec4899, #8b5cf6);
        color: white;
        border-color: transparent;
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
      }
      .choice-btn.multi-selected {
        background: linear-gradient(to right, #ec4899, #8b5cf6);
        color: white;
        border-color: transparent;
      }
      .nav-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
      }
      .nav-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 999px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      .nav-btn.prev {
        background: #f3f4f6;
        color: #555;
      }
      .nav-btn.prev:hover {
        background: #e5e7eb;
      }
      .nav-btn.next {
        background: linear-gradient(to right, #ec4899, #8b5cf6);
        color: white;
      }
      .nav-btn.next:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
      }
      .nav-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      /* Result Screen */
      .result-screen {
        display: none;
      }
      .result-screen.active {
        display: block;
        animation: fadeIn 0.5s ease-in;
      }
      .result-card {
        background: white;
        border-radius: 24px;
        padding: 32px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 24px;
      }
      .result-card h2 {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 0 24px;
        text-align: center;
        color: #1a1a2e;
      }
      .verdict {
        background: linear-gradient(to right, #fef3f2, #f3e8ff);
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 24px;
      }
      .verdict strong {
        display: block;
        font-size: 1.1rem;
        margin-bottom: 8px;
        color: #1a1a2e;
      }
      .kpi {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
        margin-bottom: 24px;
      }
      .kpi-box {
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        text-align: center;
      }
      .kpi-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 8px;
      }
      .kpi-value {
        font-size: 1.5rem;
        font-weight: 800;
        color: #1a1a2e;
      }
      .result-section {
        margin-bottom: 24px;
      }
      .result-section h3 {
        font-size: 1rem;
        font-weight: 700;
        margin: 0 0 12px;
        color: #1a1a2e;
      }
      .result-section ul {
        margin: 0;
        padding-left: 20px;
      }
      .result-section li {
        margin: 8px 0;
        line-height: 1.6;
      }
      .pill {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 700;
        margin-right: 8px;
      }
      .pill.ok {
        background: #e8fff1;
        color: #0a6b2f;
        border: 1px solid #b6f2cc;
      }
      .pill.warn {
        background: #fff7e8;
        color: #7a4b00;
        border: 1px solid #ffe0a6;
      }
      .pill.bad {
        background: #ffecec;
        color: #7a0010;
        border: 1px solid #ffc2c9;
      }
      .action-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .action-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 999px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      .action-btn.primary {
        background: linear-gradient(to right, #3b82f6, #8b5cf6);
        color: white;
      }
      .action-btn.secondary {
        background: #f3f4f6;
        color: #555;
      }
      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      footer {
        text-align: center;
        color: #666;
        font-size: 12px;
        margin-top: 24px;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @media (max-width: 640px) {
        .container {
          padding: 60px 16px 24px;
        }
        .start-screen h1 {
          font-size: 2rem;
        }
        .question-card,
        .result-card {
          padding: 24px;
        }
      }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1204894220949193"
       crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="lang-switch" role="tablist" aria-label="Language switcher">
      <button type="button" data-lang="ko" class="active">í•œêµ­ì–´</button>
      <button type="button" data-lang="en">English</button>
    </div>

    <div class="container">
      <!-- Start Screen -->
      <div class="start-screen" id="startScreen">
        <h1 data-i18n="title">í™”ì¥í’ˆ ë£¨í‹´ ë”¸ê¹ ì²´í¬</h1>
        <p class="subtitle" data-i18n-html="subtitle">
          ì§€ê¸ˆ ì“°ëŠ” ì œí’ˆ/íŠ¹ì§•ë§Œ ì²´í¬í•˜ë©´, ë£¨í‹´ì—ì„œ <b>ë¶€ì¡±Â·ê³¼ì‰</b>ì„ í‘œì‹œí•˜ê³ 
          <b>ìµœì†Œ ì¶”ì²œ</b>ì„ ì•Œë ¤ì¤ë‹ˆë‹¤. (ì°¸ê³ ìš© ì •ë³´ì´ë©° í”¼ë¶€ ì§„ë‹¨/ì¹˜ë£Œê°€ ì•„ë‹™ë‹ˆë‹¤.)
        </p>
        <button class="start-btn" id="startBtn" data-i18n="startBtn">ì‹œì‘í•˜ê¸° ğŸš€</button>
      </div>

      <!-- Question Screen -->
      <div class="question-screen" id="questionScreen">
        <div class="progress-bar">
          <div class="progress-info">
            <span id="progressText">ì§ˆë¬¸ 1 / 4</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress-bar-fill">
            <div id="progressFill" style="width: 0%"></div>
          </div>
        </div>

        <div class="question-card">
          <h2 id="questionTitle">ì§ˆë¬¸</h2>
          <div class="choices" id="choices"></div>
        </div>

        <div class="nav-buttons">
          <button class="nav-btn prev" id="prevBtn" data-i18n="btnPrev">â† ì´ì „</button>
          <button class="nav-btn next" id="nextBtn" data-i18n="btnNext">ë‹¤ìŒ â†’</button>
        </div>
      </div>

      <!-- Result Screen -->
      <div class="result-screen" id="resultScreen">
        <div class="result-card">
          <h2 data-i18n="resultTitle">ê²°ê³¼</h2>

          <div class="verdict" id="verdictBox">
            <strong id="verdictTitle">-</strong>
            <span id="verdictDetail">-</span>
          </div>

          <div class="kpi" id="kpi"></div>

          <div class="result-section">
            <h3><span class="pill ok" data-i18n="labelOk">ì¶©ë¶„</span><span data-i18n="labelOkDesc">í˜„ì¬ ì˜ ì»¤ë²„ë˜ëŠ” ê²ƒ</span></h3>
            <ul id="okList"></ul>
          </div>

          <div class="result-section">
            <h3><span class="pill bad" data-i18n="labelMissing">ë¶€ì¡±</span><span data-i18n="labelMissingDesc">ì¶”ê°€í•˜ë©´ ì¢‹ì€ ê²ƒ(ìµœì†Œ)</span></h3>
            <ul id="missingList"></ul>
          </div>

          <div class="result-section">
            <h3><span class="pill warn" data-i18n="labelSkip">ì‚­ì œ</span><span data-i18n="labelSkipDesc">ì§€ê¸ˆ ì•ˆ í•´ë„ ë˜ëŠ” ê²ƒ</span></h3>
            <ul id="skipList"></ul>
          </div>

          <div class="result-section">
            <h3><span class="pill warn" data-i18n="labelWarn">ì£¼ì˜</span><span data-i18n="labelWarnDesc">ì¤‘ë³µ/ìê·¹ ê°€ëŠ¥ì„±</span></h3>
            <ul id="warnList"></ul>
          </div>

          <div class="result-section">
            <h3 data-i18n="labelSwap">ëŒ€ì²´/ì •ë¦¬ ì¶”ì²œ</h3>
            <ul id="swapList"></ul>
          </div>

          <div class="result-section">
            <h3 data-i18n="labelMinRoutine">ì¶”ì²œ ìµœì†Œ ë£¨í‹´(ì˜ˆì‹œ)</h3>
            <ul id="minRoutineList"></ul>
          </div>

          <div class="action-buttons">
            <button class="action-btn primary" id="shareBtn" data-i18n="btnShare">ê²°ê³¼ ê³µìœ í•˜ê¸°</button>
            <button class="action-btn secondary" id="resetBtn" data-i18n="btnReset">ë‹¤ì‹œ í•˜ê¸°</button>
          </div>

          <footer data-i18n="footer">
            ì´ ê²°ê³¼ëŠ” ì‚¬ìš©ìê°€ ì„ íƒí•œ ì •ë³´ì— ê¸°ë°˜í•œ ì¼ë°˜ì  ê°€ì´ë“œì…ë‹ˆë‹¤. ê°œì¸ë³„ ì•Œë ˆë¥´ê¸°/ì§ˆí™˜/ì•½ë¬¼ ì‚¬ìš© ë“±ì€ ë°˜ì˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
          </footer>
        </div>
      </div>
    </div>

    <script>
      // Questions structure
      const QUESTIONS = [
        {
          id: "products",
          title: "ì§€ê¸ˆ ì“°ëŠ” ì œí’ˆ ì¢…ë¥˜",
          titleEn: "Product types you use",
          multiSelect: true,
          choices: [
            { value: "toner", label: "í† ë„ˆ", labelEn: "Toner" },
            { value: "serum", label: "ì—ì„¼ìŠ¤/ì„¸ëŸ¼", labelEn: "Essence/Serum" },
            { value: "lotion", label: "ë¡œì…˜", labelEn: "Lotion" },
            { value: "cream", label: "í¬ë¦¼", labelEn: "Cream" },
            { value: "sunscreen", label: "ì„ í¬ë¦¼", labelEn: "Sunscreen" },
            { value: "cushion", label: "ì¿ ì…˜/íŒŒìš´ë°ì´ì…˜", labelEn: "Cushion/Foundation" },
            { value: "allinone", label: "ì˜¬ì¸ì›", labelEn: "All-in-one" },
            { value: "exfoliant", label: "ê°ì§ˆ/íŠ¸ëŸ¬ë¸” ì¼€ì–´(AHA/BHA ë“±)", labelEn: "Exfoliant/Trouble care (AHA/BHA etc.)" },
          ],
        },
        {
          id: "traits",
          title: "ë‚´ ì œí’ˆ íŠ¹ì§•(ì²´ê° ê¸°ì¤€)",
          titleEn: "Product features (by feel)",
          multiSelect: true,
          choices: [
            { value: "hydrating", label: "ë³´ìŠµ ìœ„ì£¼", labelEn: "Hydrating focus" },
            { value: "light", label: "ìœ ë¶„ ì ìŒ/ê°€ë²¼ì›€", labelEn: "Low oil/lightweight" },
            { value: "soothing", label: "ì§„ì •/ì¿¨ë§ ëŠë‚Œ", labelEn: "Soothing/cooling feel" },
            { value: "toneup", label: "í†¤ ë³´ì •/ë©”ì´í¬ì—… ëŒ€ì²´", labelEn: "Tone correction/makeup replacement" },
            { value: "spf", label: "ìì™¸ì„  ì°¨ë‹¨ í¬í•¨", labelEn: "SPF included" },
          ],
        },
        {
          id: "skin",
          title: "í”¼ë¶€ íƒ€ì…",
          titleEn: "Skin type",
          multiSelect: false,
          choices: [
            { value: "unknown", label: "ì˜ ëª¨ë¥´ê² ìŒ", labelEn: "Not sure" },
            { value: "dry", label: "ê±´ì„±", labelEn: "Dry" },
            { value: "oily", label: "ì§€ì„±", labelEn: "Oily" },
            { value: "combo", label: "ë³µí•©ì„±", labelEn: "Combination" },
            { value: "sensitive", label: "ë¯¼ê°ì„±", labelEn: "Sensitive" },
          ],
        },
        {
          id: "goal",
          title: "ëª©í‘œ",
          titleEn: "Goal",
          multiSelect: false,
          choices: [
            { value: "simplify", label: "ìµœëŒ€í•œ ë‹¨ìˆœí™”(ê·€ì°®ìŒ ìµœì†Œ)", labelEn: "Maximize simplicity (minimize hassle)" },
            { value: "balance", label: "ê¸°ëŠ¥ ë°¸ëŸ°ìŠ¤(ìµœì†Œ êµ¬ì„±)", labelEn: "Functional balance (minimal setup)" },
            { value: "makeup", label: "í†¤ë³´ì •/ë©”ì´í¬ì—… ê²¸ìš© ì„ í˜¸", labelEn: "Prefer tone-up/makeup combo" },
          ],
        },
      ];

      // State
      let currentQuestion = 0;
      let answers = {};
      let currentLang = "ko";

      // Elements
      const $ = (sel) => document.querySelector(sel);
      const $$ = (sel) => Array.from(document.querySelectorAll(sel));

      const startScreen = $("#startScreen");
      const questionScreen = $("#questionScreen");
      const resultScreen = $("#resultScreen");
      const startBtn = $("#startBtn");
      const prevBtn = $("#prevBtn");
      const nextBtn = $("#nextBtn");
      const questionTitle = $("#questionTitle");
      const choicesContainer = $("#choices");
      const progressText = $("#progressText");
      const progressPercent = $("#progressPercent");
      const progressFill = $("#progressFill");

      // Initialize
      function init() {
        currentLang = detectLang();
        setLang(currentLang, false);
        startBtn.addEventListener("click", startQuiz);
        prevBtn.addEventListener("click", prevQuestion);
        nextBtn.addEventListener("click", nextQuestion);
        $("#resetBtn")?.addEventListener("click", resetQuiz);
        $("#shareBtn")?.addEventListener("click", shareResult);
      }

      function startQuiz() {
        currentQuestion = 0;
        answers = {};
        showQuestion();
      }

      function showQuestion() {
        startScreen.style.display = "none";
        questionScreen.classList.add("active");
        resultScreen.classList.remove("active");

        const q = QUESTIONS[currentQuestion];
        const title = currentLang === "en" ? q.titleEn : q.title;
        questionTitle.textContent = title;

        choicesContainer.innerHTML = "";
        const currentAnswers = answers[q.id] || (q.multiSelect ? [] : null);

        q.choices.forEach((choice) => {
          const btn = document.createElement("button");
          btn.className = "choice-btn";
          const label = currentLang === "en" ? choice.labelEn : choice.label;
          btn.textContent = label;

          if (q.multiSelect) {
            const isSelected = Array.isArray(currentAnswers) && currentAnswers.includes(choice.value);
            if (isSelected) btn.classList.add("multi-selected");
            btn.addEventListener("click", () => {
              const selected = answers[q.id] || [];
              const index = selected.indexOf(choice.value);
              if (index > -1) {
                selected.splice(index, 1);
              } else {
                selected.push(choice.value);
              }
              answers[q.id] = selected;
              renderChoices();
            });
          } else {
            if (currentAnswers === choice.value) btn.classList.add("selected");
            btn.addEventListener("click", () => {
              answers[q.id] = choice.value;
              renderChoices();
              setTimeout(() => {
                if (currentQuestion < QUESTIONS.length - 1) {
                  nextQuestion();
                } else {
                  showResult();
                }
              }, 300);
            });
          }

          choicesContainer.appendChild(btn);
        });

        renderChoices();
        updateProgress();
        updateNavButtons();
      }

      function renderChoices() {
        const q = QUESTIONS[currentQuestion];
        const currentAnswers = answers[q.id] || (q.multiSelect ? [] : null);

        $$(".choice-btn").forEach((btn, idx) => {
          const choice = q.choices[idx];
          btn.classList.remove("selected", "multi-selected");

          if (q.multiSelect) {
            const selected = Array.isArray(currentAnswers) && currentAnswers.includes(choice.value);
            if (selected) btn.classList.add("multi-selected");
          } else {
            if (currentAnswers === choice.value) btn.classList.add("selected");
          }
        });

        if (q.multiSelect) {
          const selected = Array.isArray(currentAnswers) ? currentAnswers.length : 0;
          nextBtn.disabled = selected === 0;
        } else {
          nextBtn.disabled = !currentAnswers;
        }
      }

      function updateProgress() {
        const total = QUESTIONS.length;
        const current = currentQuestion + 1;
        const percent = Math.round((current / total) * 100);
        progressText.textContent = currentLang === "en" ? `Question ${current} / ${total}` : `ì§ˆë¬¸ ${current} / ${total}`;
        progressPercent.textContent = `${percent}%`;
        progressFill.style.width = `${percent}%`;
      }

      function updateNavButtons() {
        prevBtn.disabled = currentQuestion === 0;
        if (currentQuestion === QUESTIONS.length - 1) {
          nextBtn.textContent = currentLang === "en" ? "ê²°ê³¼ ë³´ê¸° â†’" : "ê²°ê³¼ ë³´ê¸° â†’";
        } else {
          nextBtn.textContent = currentLang === "en" ? "Next â†’" : "ë‹¤ìŒ â†’";
        }
      }

      function prevQuestion() {
        if (currentQuestion > 0) {
          currentQuestion--;
          showQuestion();
        }
      }

      function nextQuestion() {
        const q = QUESTIONS[currentQuestion];
        const currentAnswers = answers[q.id];

        if (q.multiSelect && (!Array.isArray(currentAnswers) || currentAnswers.length === 0)) {
          return;
        }
        if (!q.multiSelect && !currentAnswers) {
          return;
        }

        if (currentQuestion < QUESTIONS.length - 1) {
          currentQuestion++;
          showQuestion();
        } else {
          showResult();
        }
      }

      function showResult() {
        questionScreen.classList.remove("active");
        resultScreen.classList.add("active");
        analyze();
      }

      function analyze() {
        const products = answers.products || [];
        const traits = answers.traits || [];
        const skin = answers.skin || "unknown";
        const goal = answers.goal || "simplify";

        // Analysis logic (same as before)
        const has = {
          cleanse: false,
          hydrate: traits.includes("hydrating") || products.some((p) => ["toner", "serum", "lotion", "cream", "allinone"].includes(p)),
          occlusive: products.includes("cream") || products.includes("lotion"),
          soothe: traits.includes("soothing") || products.includes("toner") || products.includes("serum"),
          spf: traits.includes("spf") || products.includes("sunscreen") || (products.includes("cushion") && traits.includes("toneup") && traits.includes("spf")),
          tone: traits.includes("toneup") || products.includes("cushion"),
          exfoliate: products.includes("exfoliant"),
          allinone: products.includes("allinone"),
        };

        const ok = [];
        const missing = [];
        const warn = [];
        const skip = [];
        const swap = [];
        const minRoutine = [];

        if (has.spf) ok.push(t("msgSpfOk"));
        else missing.push(t("msgSpfMissing"));

        if (has.hydrate) ok.push(t("msgHydrateOk"));
        else missing.push(t("msgHydrateMissing"));

        if (skin === "dry") {
          if (has.occlusive) ok.push(t("msgOcclusiveOk"));
          else missing.push(t("msgOcclusiveMissing"));
        }
        if (skin === "oily") {
          if (products.includes("cream") && traits.includes("hydrating") && !traits.includes("light")) {
            warn.push(t("msgOilyWarn"));
          }
        }

        if (has.exfoliate) {
          ok.push(t("msgExfoliateOk"));
          if (skin === "sensitive") warn.push(t("msgSensitiveWarn"));
        }

        const baseCount = ["toner", "serum", "lotion", "cream", "allinone"].filter((p) => products.includes(p)).length;
        if (baseCount >= 4 && goal === "simplify") warn.push(t("msgBaseCountWarn"));
        if (products.includes("allinone") && baseCount >= 3) warn.push(t("msgAllinoneWarn"));
        if (products.includes("sunscreen") && products.includes("cushion") && traits.includes("spf")) {
          warn.push(t("msgSpfOverlapWarn"));
        }

        if (products.includes("toner") && (products.includes("lotion") || products.includes("cream") || products.includes("allinone"))) {
          skip.push(t("msgTonerSkip"));
        }
        if (products.includes("serum") && baseCount >= 3) skip.push(t("msgSerumSkip"));
        if (has.spf && has.tone) skip.push(t("msgCushionSkip"));
        if (has.exfoliate) skip.push(t("msgExfoliateSkip"));

        if (products.includes("sunscreen") && products.includes("cushion")) swap.push(t("msgSunscreenCushionSwap"));
        if (products.includes("toner") && products.includes("lotion")) swap.push(t("msgTonerLotionSwap"));
        if (products.includes("lotion") && products.includes("cream")) swap.push(t("msgLotionCreamSwap"));
        if (goal === "simplify" && baseCount >= 3) swap.push(t("msgSimplifySwap"));

        if (!has.spf) minRoutine.push(t("msgMorningNoSpf"));
        else if (goal === "makeup") minRoutine.push(t("msgMorningMakeup"));
        else minRoutine.push(t("msgMorningDefault"));
        minRoutine.push(t("msgEvening"));
        if (has.exfoliate) minRoutine.push(t("msgExfoliateFreq"));

        const spfStep = has.spf ? 1 : 0;
        const toneStep = has.tone ? 1 : 0;
        const exfoliateStep = has.exfoliate ? 1 : 0;
        const currentSteps = baseCount + spfStep + toneStep + exfoliateStep;
        const minSteps = 2;
        const reducible = Math.max(0, currentSteps - minSteps);

        let verdictTitle = t("verdictMinimal");
        let verdictDetail = t("verdictMinimalDesc");
        if (!has.spf || !has.hydrate) {
          verdictTitle = t("verdictEmpty");
          verdictDetail = t("verdictEmptyDesc");
        } else if (reducible >= 2) {
          verdictTitle = t("verdictExcess");
          verdictDetail = t("verdictExcessDesc");
        } else if (reducible === 1) {
          verdictTitle = t("verdictMany");
          verdictDetail = t("verdictManyDesc");
        }

        $("#verdictTitle").textContent = verdictTitle;
        $("#verdictDetail").textContent = verdictDetail;

        const kpiContainer = $("#kpi");
        kpiContainer.innerHTML = `
          <div class="kpi-box">
            <div class="kpi-label">${t("kpiCurrent")}</div>
            <div class="kpi-value">${currentSteps}${t("unitSteps")}</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-label">${t("kpiMin")}</div>
            <div class="kpi-value">${minSteps}${t("unitSteps")}</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-label">${t("kpiReduce")}</div>
            <div class="kpi-value">-${reducible}</div>
          </div>
        `;

        renderList($("#okList"), ok);
        renderList($("#missingList"), missing);
        renderList($("#warnList"), warn);
        renderList($("#skipList"), skip);
        renderList($("#swapList"), swap);
        renderList($("#minRoutineList"), minRoutine);
      }

      function renderList(el, items) {
        el.innerHTML = "";
        if (!items.length) {
          const li = document.createElement("li");
          li.textContent = "-";
          el.appendChild(li);
          return;
        }
        items.forEach((t) => {
          const li = document.createElement("li");
          li.textContent = t;
          el.appendChild(li);
        });
      }

      function resetQuiz() {
        currentQuestion = 0;
        answers = {};
        startScreen.style.display = "block";
        questionScreen.classList.remove("active");
        resultScreen.classList.remove("active");
      }

      function shareResult() {
        const url = new URL(window.location.href);
        url.searchParams.set("r", JSON.stringify(answers));
        navigator.clipboard.writeText(url.toString());
        alert(currentLang === "en" ? "Link copied!" : "ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
      }

      // i18n
      const translations = {
        ko: {
          title: "í™”ì¥í’ˆ ë£¨í‹´ ë”¸ê¹ ì²´í¬",
          subtitle: "ì§€ê¸ˆ ì“°ëŠ” ì œí’ˆ/íŠ¹ì§•ë§Œ ì²´í¬í•˜ë©´, ë£¨í‹´ì—ì„œ <b>ë¶€ì¡±Â·ê³¼ì‰</b>ì„ í‘œì‹œí•˜ê³  <b>ìµœì†Œ ì¶”ì²œ</b>ì„ ì•Œë ¤ì¤ë‹ˆë‹¤. (ì°¸ê³ ìš© ì •ë³´ì´ë©° í”¼ë¶€ ì§„ë‹¨/ì¹˜ë£Œê°€ ì•„ë‹™ë‹ˆë‹¤.)",
          startBtn: "ì‹œì‘í•˜ê¸° ğŸš€",
          btnPrev: "â† ì´ì „",
          btnNext: "ë‹¤ìŒ â†’",
          resultTitle: "ê²°ê³¼",
          kpiCurrent: "í˜„ì¬ ë‹¨ê³„ ìˆ˜",
          kpiMin: "ì¶”ì²œ ìµœì†Œ ë‹¨ê³„",
          kpiReduce: "ì¤„ì¼ ìˆ˜ ìˆëŠ” ë‹¨ê³„",
          labelOk: "ì¶©ë¶„",
          labelOkDesc: "í˜„ì¬ ì˜ ì»¤ë²„ë˜ëŠ” ê²ƒ",
          labelMissing: "ë¶€ì¡±",
          labelMissingDesc: "ì¶”ê°€í•˜ë©´ ì¢‹ì€ ê²ƒ(ìµœì†Œ)",
          labelSkip: "ì‚­ì œ",
          labelSkipDesc: "ì§€ê¸ˆ ì•ˆ í•´ë„ ë˜ëŠ” ê²ƒ",
          labelWarn: "ì£¼ì˜",
          labelWarnDesc: "ì¤‘ë³µ/ìê·¹ ê°€ëŠ¥ì„±",
          labelSwap: "ëŒ€ì²´/ì •ë¦¬ ì¶”ì²œ",
          labelMinRoutine: "ì¶”ì²œ ìµœì†Œ ë£¨í‹´(ì˜ˆì‹œ)",
          btnShare: "ê²°ê³¼ ê³µìœ í•˜ê¸°",
          btnReset: "ë‹¤ì‹œ í•˜ê¸°",
          footer: "ì´ ê²°ê³¼ëŠ” ì‚¬ìš©ìê°€ ì„ íƒí•œ ì •ë³´ì— ê¸°ë°˜í•œ ì¼ë°˜ì  ê°€ì´ë“œì…ë‹ˆë‹¤. ê°œì¸ë³„ ì•Œë ˆë¥´ê¸°/ì§ˆí™˜/ì•½ë¬¼ ì‚¬ìš© ë“±ì€ ë°˜ì˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
          msgSpfOk: "ìì™¸ì„  ì°¨ë‹¨(ì„ ì¼€ì–´)",
          msgSpfMissing: "ìì™¸ì„  ì°¨ë‹¨: ì„ í¬ë¦¼(ë˜ëŠ” SPF í¬í•¨ ì œí’ˆ) 1ê°œëŠ” ê±°ì˜ í•„ìˆ˜ì— ê°€ê¹ìŠµë‹ˆë‹¤.",
          msgHydrateOk: "ê¸°ë³¸ ë³´ìŠµ(ìˆ˜ë¶„ ê³µê¸‰)",
          msgHydrateMissing: "ê¸°ë³¸ ë³´ìŠµ: ê°€ë²¼ìš´ ë³´ìŠµì œ(ë¡œì…˜/ì˜¬ì¸ì›/ìˆ˜ë¶„í¬ë¦¼ ì¤‘ 1ê°œ)",
          msgOcclusiveOk: "ìœ ë¶„/ë§‰ í˜•ì„±(ê±´ì„± ë³´ì™„)",
          msgOcclusiveMissing: "ê±´ì„± ë³´ì™„: í¬ë¦¼ ë˜ëŠ” ì˜¤í´ë£¨ì‹œë¸Œ(ë§‰ í˜•ì„±) ì—­í•  1ê°œ",
          msgOilyWarn: "ì§€ì„±ì¸ë° í¬ë¦¼/ë³´ìŠµ ìœ„ì£¼ ì¡°í•©ì´ ë¬´ê²ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë²ˆë“¤/ë°€ë¦¼ ê°€ëŠ¥).",
          msgExfoliateOk: "ê°ì§ˆ/íŠ¸ëŸ¬ë¸” ì¼€ì–´",
          msgSensitiveWarn: "ë¯¼ê°ì„± + ê°ì§ˆ/íŠ¸ëŸ¬ë¸” ì¼€ì–´ëŠ” ìê·¹ ê°€ëŠ¥ì„±ì´ ë†’ì•„ ë¹ˆë„/ë†ë„ ì¡°ì ˆì´ í•„ìš”í•©ë‹ˆë‹¤.",
          msgBaseCountWarn: "ê¸°ì´ˆ ë‹¨ê³„ê°€ ë§ìŠµë‹ˆë‹¤. ë‹¨ìˆœí™” ëª©í‘œë¼ë©´ 1~2ë‹¨ê³„ë¡œ ì¤„ì—¬ë„ ì²´ê° ì°¨ì´ê°€ ì ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          msgAllinoneWarn: "ì˜¬ì¸ì›ì´ ìˆëŠ”ë° ê¸°ì´ˆê°€ ì—¬ëŸ¬ ê°œ ê²¹ì¹©ë‹ˆë‹¤. ì˜¬ì¸ì› ì¤‘ì‹¬ìœ¼ë¡œ ì •ë¦¬ ê°€ëŠ¥í•´ ë³´ì…ë‹ˆë‹¤.",
          msgSpfOverlapWarn: "SPF ì œí’ˆì´ 2ê°œ ì´ìƒ ê²¹ì¹©ë‹ˆë‹¤. ì‚¬ìš©ê°/ë°€ë¦¼ì´ ìƒê¸°ë©´ í•˜ë‚˜ë§Œ ë‚¨ê²¨ë„ ë©ë‹ˆë‹¤.",
          msgTonerSkip: "í† ë„ˆ: ë¡œì…˜/í¬ë¦¼/ì˜¬ì¸ì›ì´ ìˆìœ¼ë©´ í•„ìˆ˜ ì•„ë‹˜",
          msgSerumSkip: "ì„¸ëŸ¼: ê¸°ì´ˆ ë‹¨ê³„ê°€ ë§ìœ¼ë©´ ìš°ì„  ë¹¼ê³  ì²´ê° í™•ì¸",
          msgCushionSkip: "ì¿ ì…˜/í†¤ë³´ì •: ì„ ì¼€ì–´ê°€ ì¶©ë¶„í•˜ë©´ ìƒëµ ê°€ëŠ¥",
          msgExfoliateSkip: "ê°ì§ˆ ì¼€ì–´: ë§¤ì¼ì€ ë¶ˆí•„ìš”(ì£¼ 2~3íšŒë©´ ì¶©ë¶„)",
          msgSunscreenCushionSwap: "ì„ í¬ë¦¼ + ì¿ ì…˜ â†’ í†¤ì—… ì„ í¬ë¦¼ 1ê°œë¡œ í•©ì¹˜ê¸° ê°€ëŠ¥",
          msgTonerLotionSwap: "í† ë„ˆ + ë¡œì…˜ â†’ ê°€ë²¼ìš´ ë¡œì…˜ 1ê°œë¡œ ëŒ€ì²´ ê°€ëŠ¥",
          msgLotionCreamSwap: "ë¡œì…˜ + í¬ë¦¼ â†’ ë³´ìŠµê° ê¸°ì¤€ìœ¼ë¡œ 1ê°œë§Œ ë‚¨ê¸°ê¸°",
          msgSimplifySwap: "ê¸°ì´ˆ ë‹¤ë‹¨ê³„ â†’ ì˜¬ì¸ì› 1ê°œ ë˜ëŠ” ë¡œì…˜ 1ê°œë¡œ ì •ë¦¬ ê¶Œì¥",
          msgMorningNoSpf: "ì•„ì¹¨: ê°€ë²¼ìš´ ë³´ìŠµ 1ê°œ + ì„ í¬ë¦¼ 1ê°œ(ì¶”ê°€)",
          msgMorningMakeup: "ì•„ì¹¨: í†¤ì—… ê°€ëŠ¥í•œ ì„ í¬ë¦¼ 1ê°œë¡œ í†µí•©",
          msgMorningDefault: "ì•„ì¹¨: ë³´ìŠµ 1ê°œ + ì„ ì¼€ì–´ 1ê°œ",
          msgEvening: "ì €ë…: ë³´ìŠµ 1ê°œë§Œ",
          msgExfoliateFreq: "ê°ì§ˆ ì¼€ì–´: ì£¼ 2~3íšŒë¡œ ë¹ˆë„ ë‚®ì¶”ê¸°",
          verdictMinimal: "ğŸ‘‰ ì´ë¯¸ ìµœì†Œ ë£¨í‹´ì…ë‹ˆë‹¤",
          verdictMinimalDesc: "ì§€ê¸ˆë³´ë‹¤ ë” ì¤„ì´ë©´ ë³´ìŠµ ì²´ê°ì´ ë–¨ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.",
          verdictEmpty: "ğŸ‘‰ í•µì‹¬ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤",
          verdictEmptyDesc: "ë³´ìŠµ ë˜ëŠ” ì„ ì¼€ì–´ ì¤‘ í•˜ë‚˜ëŠ” ê¼­ ì±„ìš°ëŠ” í¸ì´ ì•ˆì „í•©ë‹ˆë‹¤.",
          verdictExcess: "ğŸ‘‰ ì§€ê¸ˆ ë£¨í‹´ì€ ì¡°ê¸ˆ ê³¼í•©ë‹ˆë‹¤",
          verdictExcessDesc: "2ë‹¨ê³„ê¹Œì§€ ì¤„ì—¬ë„ ì²´ê° ì°¨ì´ê°€ ê±°ì˜ ì—†ì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.",
          verdictMany: "ğŸ‘‰ ì•½ê°„ ë§ì€ í¸ì…ë‹ˆë‹¤",
          verdictManyDesc: "í•œ ë‹¨ê³„ë§Œ ì¤„ì—¬ë„ ê·€ì°®ìŒì´ ëˆˆì— ë„ê²Œ ì¤„ì–´ë“­ë‹ˆë‹¤.",
          unitSteps: "ë‹¨ê³„",
        },
        en: {
          title: "Cosmetics Routine Checker",
          subtitle: "Check your current products/features, and we'll show <b>gapsÂ·excess</b> in your routine and recommend <b>minimal essentials</b>. (Reference info only, not a skin diagnosis/treatment.)",
          startBtn: "Start ğŸš€",
          btnPrev: "â† Previous",
          btnNext: "Next â†’",
          resultTitle: "Result",
          kpiCurrent: "Current steps",
          kpiMin: "Recommended minimum",
          kpiReduce: "Steps you can reduce",
          labelOk: "Sufficient",
          labelOkDesc: "Currently well covered",
          labelMissing: "Missing",
          labelMissingDesc: "Good to add (minimum)",
          labelSkip: "Skip",
          labelSkipDesc: "Not needed now",
          labelWarn: "Caution",
          labelWarnDesc: "Duplication/irritation risk",
          labelSwap: "Swap/consolidate suggestions",
          labelMinRoutine: "Recommended minimal routine (example)",
          btnShare: "Share Result",
          btnReset: "Try Again",
          footer: "This result is a general guide based on your selections. Individual allergies/conditions/medications cannot be reflected.",
          msgSpfOk: "SPF (sun care)",
          msgSpfMissing: "SPF: One sunscreen (or SPF product) is almost essential.",
          msgHydrateOk: "Basic hydration (moisture supply)",
          msgHydrateMissing: "Basic hydration: One lightweight moisturizer (lotion/all-in-one/moisturizer)",
          msgOcclusiveOk: "Oil/barrier formation (dry skin support)",
          msgOcclusiveMissing: "Dry skin support: One cream or occlusive (barrier-forming) product",
          msgOilyWarn: "Oily skin with cream/hydrating combo may feel heavy (pilling/stickiness possible).",
          msgExfoliateOk: "Exfoliant/trouble care",
          msgSensitiveWarn: "Sensitive + exfoliant/trouble care has high irritation risk, frequency/concentration control needed.",
          msgBaseCountWarn: "Too many base steps. For simplification goal, reducing to 1-2 steps may have minimal difference.",
          msgAllinoneWarn: "All-in-one exists but base steps overlap. Can consolidate around all-in-one.",
          msgSpfOverlapWarn: "Two or more SPF products overlap. If pilling/stickiness occurs, keep only one.",
          msgTonerSkip: "Toner: Not essential if lotion/cream/all-in-one exists",
          msgSerumSkip: "Serum: If base steps are many, remove first and check feel",
          msgCushionSkip: "Cushion/tone-up: Can skip if sun care is sufficient",
          msgExfoliateSkip: "Exfoliant care: Not needed daily (2-3 times/week is enough)",
          msgSunscreenCushionSwap: "Sunscreen + cushion â†’ Can combine into one tone-up sunscreen",
          msgTonerLotionSwap: "Toner + lotion â†’ Can replace with one lightweight lotion",
          msgLotionCreamSwap: "Lotion + cream â†’ Keep only one based on moisturizing feel",
          msgSimplifySwap: "Multi-step base â†’ Recommend consolidating to all-in-one or one lotion",
          msgMorningNoSpf: "Morning: One lightweight moisturizer + one sunscreen (add)",
          msgMorningMakeup: "Morning: Integrate into one tone-up sunscreen",
          msgMorningDefault: "Morning: One moisturizer + one sun care",
          msgEvening: "Evening: One moisturizer only",
          msgExfoliateFreq: "Exfoliant care: Lower frequency to 2-3 times/week",
          verdictMinimal: "ğŸ‘‰ Already minimal routine",
          verdictMinimalDesc: "Reducing further may lower moisturizing feel.",
          verdictEmpty: "ğŸ‘‰ Core is missing",
          verdictEmptyDesc: "It's safer to fill either hydration or sun care.",
          verdictExcess: "ğŸ‘‰ Current routine is a bit excessive",
          verdictExcessDesc: "Reducing by 2 steps may have almost no difference in feel.",
          verdictMany: "ğŸ‘‰ Slightly too many",
          verdictManyDesc: "Reducing by one step will noticeably reduce hassle.",
          unitSteps: "steps",
        },
      };

      function t(key, vars = {}) {
        const langTable = translations[currentLang] || translations.ko;
        const template = langTable?.[key] ?? translations.ko?.[key] ?? key;
        if (typeof template !== "string") return template;
        return template.replace(/\{(\w+)\}/g, (_, token) => (vars[token] !== undefined ? vars[token] : `{${token}}`));
      }

      function applyTranslations() {
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          el.textContent = t(el.dataset.i18n);
        });
        document.querySelectorAll("[data-i18n-html]").forEach((el) => {
          el.innerHTML = t(el.dataset.i18nHtml);
        });
      }

      function setLang(lang, updateUrl = true) {
        if (!translations[lang]) lang = "ko";
        currentLang = lang;
        document.documentElement.lang = lang;
        localStorage.setItem("preferredLang", lang);
        document.querySelectorAll(".lang-switch button").forEach((button) => {
          button.classList.toggle("active", button.dataset.lang === lang);
        });
        applyTranslations();
        if (questionScreen.classList.contains("active")) {
          showQuestion();
        }
        if (resultScreen.classList.contains("active")) {
          analyze();
        }
        if (updateUrl) {
          const url = new URL(window.location.href);
          url.searchParams.set("lang", lang);
          window.history.replaceState({}, "", url);
        }
      }

      function detectLang() {
        const params = new URLSearchParams(window.location.search);
        const paramLang = params.get("lang");
        if (paramLang && translations[paramLang]) return paramLang;
        const stored = localStorage.getItem("preferredLang");
        if (stored && translations[stored]) return stored;
        const browserLang = navigator.languages?.[0] || navigator.language;
        if (browserLang?.toLowerCase().startsWith("ko")) return "ko";
        return "en";
      }

      document.querySelectorAll(".lang-switch button").forEach((button) => {
        button.addEventListener("click", () => {
          setLang(button.dataset.lang, true);
        });
      });

      init();
    </script>

    <ins class="adsbygoogle"
       style="display:block; text-align:center"
       data-ad-client="ca-pub-1204894220949193"
       data-ad-slot="5145068706"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
    <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </body>
</html>
